import{b as D,j as P,w as C,v as A,o as l,c as o,t as c,h as _,F as O,g as R,u as z,a as L,r as B,d as G,f as t,n as b,k as V,i as w,l as N,m as S,p as q,q as H,s as J}from"./index-bBGUjAsK.js";import{u as $,a as Q,b as U,g as W}from"./firebase-TgT6_eK_.js";import{_ as X}from"./_plugin-vue_export-helper-x3n3nnut.js";import"https://www.gstatic.com/firebasejs/9.6.2/firebase-app.js";import"https://www.gstatic.com/firebasejs/9.6.2/firebase-firestore.js";import"https://www.gstatic.com/firebasejs/9.6.2/firebase-auth.js";const Y=["name","id"],Z={key:0,value:"",disabled:"",selected:""},ee=["value"],F={__name:"selectComponent",props:{name:{type:String,required:!0},elementos:{type:Array,required:!0},text:{type:String,required:!1,default:"Selecciona una opciÃ³n"},selectedValue:{type:[String,Number,Boolean],required:!1,default:""}},setup(i){const{name:u,elementos:p,text:h,selectedValue:g}=i,m=D(g);return P(()=>g,e=>{m.value=e},{immediate:!0,deep:!0}),(e,v)=>C((l(),o("select",{name:i.name,id:i.name,class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5","onUpdate:modelValue":v[0]||(v[0]=r=>m.value=r),onBlur:v[1]||(v[1]=r=>e.$emit("update:selectedValue",m.value)),onChange:v[2]||(v[2]=r=>e.$emit("update:selectedValue",m.value))},[i.selectedValue?_("",!0):(l(),o("option",Z,c(i.text),1)),(l(!0),o(O,null,R(i.elementos,r=>(l(),o("option",{key:r.name,value:r.value??r.name},c(r.name),9,ee))),128))],40,Y)),[[A,m.value]])}},I=i=>{Toastify({text:i,backgroundColor:"linear-gradient(to right, #00b09b, #96c93d)",duration:3e3}).showToast()},K=i=>new Promise(u=>{Q(i,p=>{u(p.docs.map(h=>({id:h.id,...h.data()})))})}),j={name:"devices",space:"spaces",unitName:"units",executorName:"executores",async getUnits(){return await K(this.unitName)},async getExecutors(){return await K(this.executorName)},async updateDevice(i,u,p){await $(this.space,i,this.name,u,p)}},te=i=>Object.values(i).some(u=>u===""),y=i=>(H("data-v-93098b9f"),i=i(),J(),i),ae={class:"bg-gray-200"},se={key:0,class:"flex items-center justify-center h-screen"},le=y(()=>t("div",{class:"flex flex-col items-center justify-center"},[t("i",{class:"bx bx-loader-alt bx-spin bx-lg text-gray-400",style:{"vertical-align":"middle"},title:"Cargando"}),t("p",{class:"text-2xl font-medium text-gray-400"},"Cargando dispositivo...")],-1)),ie=[le],oe={key:1,class:"flex items-center justify-center h-screen"},ne=y(()=>t("div",{class:"flex flex-col items-center justify-center"},[t("i",{class:"bx bx-error bx-lg text-red-500",style:{"vertical-align":"middle"},title:"Error"}),t("p",{class:"text-2xl font-medium text-red-500"},"No se ha encontrado el dispositivo")],-1)),re=[ne],ue={key:2,class:"flex items-center justify-between bg-white p-4"},de={class:"text-4xl font-bold text-gray-600"},ce={class:"flex items-center justify-center"},me={class:"flex items-start justify-start p-1"},ve={key:0,class:"flex items-center justify-start text-red-500 p-2 rounded-lg"},pe=y(()=>t("i",{class:"bx bx-error bx-lg",style:{"vertical-align":"middle"},title:"Error"},null,-1)),xe={class:"text-lg font-medium"},ye={class:"h-screen"},ge={key:0,class:"flex flex-col items-start justify-start m-4"},be={class:"text-2xl font-medium text-gray-600 p-4"},fe=y(()=>t("i",{class:b(["bx","bx-id-card","bx-lg","text-gray-400"]),style:{"vertical-align":"middle"},title:"ID del dispositivo"},null,-1)),_e=y(()=>t("i",{class:b(["bx","bx-rename","bx-lg","text-gray-400"]),style:{"vertical-align":"middle"},title:"Nombre del dispositivo"},null,-1)),he={key:0,class:"cursor-pointer"},ke={key:0,class:"cursor-pointer"},we=y(()=>t("i",{class:"bx bxs-data bx-lg text-gray-400",title:"Valor del sensor"},null,-1)),Ve={key:0,class:"text-2xl font-medium text-gray-600 p-4 cursor-pointer",title:"Valor base de datos"},De=y(()=>t("div",{class:"flex items -center justify-center m-2"},[t("p",{class:"text-base font-medium text-gray-600"},[t("span",null,"Para modificar el nombre , la undiad o el valor asociado haga doble click sobre el campo."),t("br"),t("span",null,"Cuando termine su modificacion haga click en enter o en cualquier click en cualquier parte de la pantalla.")])],-1)),Ce={key:1,class:"flex flex-col items-start justify-start h-screen m-4"},Ne={class:"text-2xl font-medium text-gray-600 p-4"},Se=y(()=>t("i",{class:b(["bx","bx-id-card","bx-lg","text-gray-400"]),style:{"vertical-align":"middle"},title:"ID del dispositivo"},null,-1)),je=y(()=>t("i",{class:b(["bx","bx-rename","bx-lg","text-gray-400"]),style:{"vertical-align":"middle"},title:"Nombre del dispositivo"},null,-1)),$e={key:0},Ee={key:0},Be={class:"text-2xl font-medium text-gray-600 p-4",title:"Estado del dispositivo"},qe=y(()=>t("div",{class:"flex items -center justify-center m-2"},[t("p",{class:"text-base font-medium text-gray-600"},[t("span",null,"Para modificar el nombre o el dispositivo asociado haga doble click sobre el campo."),t("br"),t("span",null,"Cuando termine su modificacion haga click en enter o en cualquier click en cualquier parte de la pantalla.")])],-1)),Ue={__name:"deviceView",setup(i){const{params:{id:u,device:p}}=z(),h=L(),g="spaces",m="devices",e=D({}),v=B([]),r=B([]),f=D(""),d=D(null),k=n=>{d.value=n},M=n=>v.filter(s=>s.idSpace===e.value.idSpace&&s.type===e.value.type&&s.id!==e.value.id).some(s=>s.name===n),T=async()=>{r.splice(0,r.length),e.value.type==="sensor"&&(await j.getUnits()).map(a=>r.push({...a})),e.value.type==="executor"&&(await j.getExecutors()).map(a=>r.push({...a}))},x=async()=>{try{te(e.value)?(f.value="No puedes guardar un dato vacio",await E(),console.log("entre..")):d.value==="name"?M(e.value.name)?(await E(),f.value="El nombre ya existe en el espacio seleccionado"):(await $(g,u,m,p,{name:e.value.name}),d.value=null,I("Cambios guardados"),f.value=""):(await $(g,u,m,p,{[d.value]:e.value[d.value]}),d.value=null,I("Cambios guardados"),f.value=""),d.value=null}catch(n){console.error(n)}},E=async()=>{await U(g,u,m,p,n=>{e.value={id:n.id,...n.data()}})};return G(async()=>{try{await U(g,u,m,p,async n=>{e.value={id:n.id,...n.data()},await T()}),await W(g,u,m,n=>{v.splice(0,v.length),n.forEach(a=>v.push({id:a.id,...a.data()}))})}catch(n){console.error(n)}}),(n,a)=>(l(),o("main",ae,[e.value.id?_("",!0):(l(),o("div",se,ie)),e.value.type?_("",!0):(l(),o("div",oe,re)),e.value.type?(l(),o("div",ue,[t("h1",de,[t("i",{class:b(["bx",e.value.type==="sensor"?"bx-radar":"bx-devices","bx-lg","text-gray-400"]),style:{"vertical-align":"middle"},title:"Nombre del dispositivo"},null,2),V(" "+c(e.value.type==="sensor"?"Sensor":"Ejecutor"),1)]),t("div",ce,[t("i",{class:"bx bx-arrow-back bx-lg text-gray-400 cursor-pointer p-4",style:{"vertical-align":"middle"},title:"Volver",onClick:a[0]||(a[0]=s=>w(h).push({name:"space",params:{id:w(u)}}))})])])):_("",!0),t("div",me,[f.value?(l(),o("div",ve,[pe,t("p",xe,c(f.value),1)])):_("",!0)]),t("div",ye,[e.value.type==="sensor"?(l(),o("div",ge,[t("p",be,[fe,V(" "+c(e.value.id),1)]),t("p",{class:"text-2xl font-medium text-gray-600 p-4",onDblclick:a[2]||(a[2]=s=>k("name"))},[_e,d.value!=="name"?(l(),o("span",he,c(e.value.name),1)):C((l(),o("input",{key:1,"onUpdate:modelValue":a[1]||(a[1]=s=>e.value.name=s),onBlur:x,onKeyup:S(x,["enter"])},null,544)),[[N,e.value.name]])],32),t("p",{class:"text-2xl font-medium text-gray-600 p-4",title:"Unidad de medida del sensor",onDblclick:a[4]||(a[4]=s=>k("unit"))},[t("i",{class:b(["bx",e.value.type==="sensor"?"bx-radar":"bx-devices","bx-lg","text-gray-400"]),style:{"vertical-align":"middle"},title:"Dispositivo asociado"},null,2),d.value!=="unit"?(l(),o("span",ke,c(e.value.unit),1)):(l(),q(F,{key:1,name:"unit",elementos:r,selectedValue:e.value.unit,"onUpdate:selectedValue":a[3]||(a[3]=s=>e.value.unit=s),onBlur:x,onChange:x},null,8,["elementos","selectedValue"]))],32),t("p",{class:"text-base font-medium flex items-center p-4",title:"Valor del sensor",onDblclick:a[6]||(a[6]=s=>k("value"))},[we,d.value!=="value"?(l(),o("span",Ve,c(e.value.value),1)):C((l(),o("input",{key:1,"onUpdate:modelValue":a[5]||(a[5]=s=>e.value.value=s),onBlur:x,onKeyup:S(x,["enter"])},null,544)),[[N,e.value.value]])],32),De])):e.value.type==="executor"?(l(),o("div",Ce,[t("p",Ne,[Se,V(" "+c(e.value.id),1)]),t("p",{class:"text-2xl font-medium text-gray-600 p-4",onDblclick:a[8]||(a[8]=s=>k("name"))},[je,d.value!=="name"?(l(),o("span",$e,c(e.value.name),1)):C((l(),o("input",{key:1,"onUpdate:modelValue":a[7]||(a[7]=s=>e.value.name=s),onBlur:x,onKeyup:S(x,["enter"])},null,544)),[[N,e.value.name]])],32),t("p",{class:"text-2xl font-medium text-gray-600 p-4",title:"Dispositivo conectado ",onDblclick:a[10]||(a[10]=s=>k("executor"))},[t("i",{class:b(["bx",e.value.type==="sensor"?"bx-radar":"bx-devices","bx-lg","text-gray-400"]),style:{"vertical-align":"middle"},title:"Dispositivo asociado"},null,2),d.value!=="executor"?(l(),o("span",Ee,c(e.value.executor),1)):(l(),q(F,{key:1,name:"executor",elementos:r,selectedValue:e.value.executor,"onUpdate:selectedValue":a[9]||(a[9]=s=>e.value.executor=s),onBlur:x,onChange:x},null,8,["elementos","selectedValue"]))],32),t("p",Be,[t("i",{class:b(["bx",Number(e.value.state)===1?"bxs-toggle-right":"bxs-toggle-left","bx-lg","cursor-pointer",Number(e.value.state)===1?"text-green-500":"text-red-500","rounded-full","transition-opacity duration-300 ease-in-out"]),style:{"vertical-align":"middle",opacity:"1"},title:"Estado del ejecutor",onClick:a[11]||(a[11]=s=>w(j).updateDevice(w(u),w(p),{state:Number(e.value.state)===1?0:1}))},null,2),V(" "+c(Number(e.value.state)===1?"Encendido":"Apagado"),1)]),qe])):_("",!0)])]))}},Ae=X(Ue,[["__scopeId","data-v-93098b9f"]]);export{Ae as default};
